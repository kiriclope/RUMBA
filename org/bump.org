#+STARTUP: fold
#+TITLE: Continuous Bump Attractor Model
#+PROPERTY: header-args:ipython :results both :exports both :async yes :session dual_data :kernel dual_data

* notebook settings
#+begin_src ipython
  %load_ext autoreload
  %autoreload 2
  %reload_ext autoreload

  %run ../notebooks/setup.py
  %matplotlib inline
  %config InlineBackend.figure_format = 'png'
#+end_src

#+RESULTS:
:RESULTS:
: The autoreload extension is already loaded. To reload it, use:
:   %reload_ext autoreload
: Python exe
: /home/leon/mambaforge/envs/dual_data/bin/python
: <Figure size 600x370.82 with 0 Axes>
:END:

* Continuous Bump Attractor Model

Here I will explain how to use the package to run a one population continuous attractor network model.

** imports
#+begin_src ipython
  import sys
  sys.path.insert(0, '/home/leon/tmp/rnn_numba') # put here the path to the repo
  from src.model.rate_model import Network
#+end_src

#+RESULTS:

#+begin_src ipython
  import pandas as pd
  from src.analysis.decode import decode_bump, circcvl
#+end_src

#+RESULTS:
** Single trial
*** Simulation
To run a simulation, first we need to define a network model.
The class Network takes three mandatory arguments:

                1. The name of the configuration file that defines the model,
                   eg 'config_bump.yml', these files are in ../conf/ and well detailed.
                   
                2. The name of the output file that will contain the simulation data.
                   eg 'bump'. Simulation results will be saved as a data frame to '../data/simul/bump.h5'.
                   
                3. The path to the root of this repository.

One can also pass extra arguments to Network, basically any parameter that is in the config file so that it will be overwritten.

Here is an example:

#+begin_src ipython
    REPO_ROOT = "/home/leon/tmp/rnn_numba"
    model = Network('config_bump.yml', 'bump', REPO_ROOT, VERBOSE=1, NUM_THREADS=116)
    # Here for example, we are adding two extra parameters 
#+end_src

#+RESULTS:
: Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
: Saving data to /home/leon/tmp/rnn_numba/data/simul/bump.h5
: Jab [[-2.75]]
: Tuning, KAPPA [0.4]
: Asymmetry, SIGMA [0.]
: Iext [14.]

Then one just runs the model with
#+begin_src ipython
  model.run()
#+end_src

#+RESULTS:
#+begin_example
  Generating matrix Cij
  all to all connectivity
  with cosine structure
  Saving matrix to /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Parameters:
  N 1000 Na [1000] K 1.0 Ka [1.]
  Iext [14.] Jab [-2.75]
  Tuning, KAPPA [0.4]
  Asymmetry, SIGMA [0.]
  MF Rates: [5.09090909]
  Transfert Func Sigmoid
  Running simulation
  times (s) 0.5 rates (Hz) [2.19]
  times (s) 1.0 rates (Hz) [2.15]
  STIM ON
  times (s) 1.5 rates (Hz) [6.26]
  STIM OFF
  times (s) 2.0 rates (Hz) [5.87]
  times (s) 2.5 rates (Hz) [5.87]
  times (s) 3.0 rates (Hz) [5.89]
  times (s) 3.5 rates (Hz) [5.89]
  times (s) 4.0 rates (Hz) [5.89]
  saving data to /home/leon/tmp/rnn_numba/data/simul/bump.h5
  Elapsed (with compilation) = 13.72017726697959s
#+end_example

*** Connectivity
#+begin_src ipython
from src.analysis.plot_utils import plot_con
#+end_src

#+RESULTS:

#+begin_src ipython
  Cij = model.Cij
#+end_src

#+RESULTS:
: True

#+begin_src ipython
  plot_con(model.Cij)
#+end_src

#+RESULTS:
:RESULTS:
: /home/leon/mambaforge/envs/dual_data/lib/python3.8/site-packages/IPython/core/events.py:89: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.
:   func(*args, **kwargs)
: /home/leon/mambaforge/envs/dual_data/lib/python3.8/site-packages/IPython/core/pylabtools.py:152: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.
:   fig.canvas.print_figure(bytes_io, **kw)
[[file:./.ob-jupyter/ca6e0f6400e61020f092fb4a0d36feb6479587b5.png]]
:END:

#+begin_src ipython

#+end_src

#+RESULTS:

*** Analysis

Most of the code for the analysis of the results of the simulations comes from
../src/analysis/plot_utils.py and ../src/analysis/decode.py But here we will
reimplement some of it.

**** Imports
#+begin_src ipython
  import pandas as pd
  from src.analysis.decode import decode_bump, circcvl
#+end_src

#+RESULTS:

**** Load data

#+begin_src ipython
  df = pd.read_hdf(REPO_ROOT + "/data/simul/bump.h5", mode="r")  
  print(df.head())
#+end_src

#+RESULTS:
:       rates         ff       h_E  neurons   time
: 0  2.296572  -4.850843 -6.002947        0  0.499
: 1  1.836227   3.645746 -6.003618        1  0.499
: 2  1.974827  -0.252310 -6.004289        2  0.499
: 3  1.436408  -4.915340 -6.004962        3  0.499
: 4  2.562498  13.617294 -6.005635        4  0.499

The dataframe from a simulation contains 5 cols corresponding to
the rates of the neurons, the total feedforward input (ff), the net recurrent input (h_E), the neuron id, and the time step.

**** Rates
***** Raster plot

#+begin_src ipython
  fig, ax = plt.subplots()
  pt = pd.pivot_table(df, values="rates", index=["neurons"], columns="time")

  sns.heatmap(pt, cmap="jet", ax=ax, vmax=15, vmin=0)
  ax.set_yticks([0, 500, 1000], [0, 500, 1000])
  ax.set_xticks([0, 2, 4, 6, 8], [0, 1, 2, 3, 4])
  ax.set_title('Excitatory')
  
  plt.show()
#+end_src

#+RESULTS:
[[file:./.ob-jupyter/90ae003a9dc999bddc6365cda244b1a11f12b418.png]]

***** Rates Distribution

#+begin_src ipython
  mean_df = df.groupby("neurons").mean()
  mean_df[mean_df.rates<.01] = np.nan

  sns.histplot(mean_df, x=mean_df.rates, kde=True, color='r')
  plt.xlabel("Rates (au)")
  plt.show()
#+end_src

#+RESULTS:
[[file:./.ob-jupyter/3447ed6b9adee58fe4d77017ddec9f4f7aa63b2f.png]]

**** Tuning
***** Fourier moments and phase
Here we use the functions from ../src/analysis/decode.py to decode the location and amplitude of the bump.

#+begin_src ipython
  data = df.groupby(['time'])['rates'].apply(decode_bump).reset_index()
  data[['m0', 'm1', 'phase']] = pd.DataFrame(data['rates'].tolist(), index=data.index)
  data = data.drop(columns=['rates'])

  print(data.head())
#+end_src

#+RESULTS:
:     time        m0        m1     phase
: 0  0.499  2.185564  0.083533  1.423525
: 1  0.999  2.150278  0.124635  5.326577
: 2  1.499  6.259649  7.148045  3.123662
: 3  1.999  5.873048  5.462709  3.126520
: 4  2.499  5.868035  5.541674  3.025176

This new dataframe contains 4 cols: the time step, the mean activity (m0), the amplitude of the bump (m1, this is the first fourier moment of the population vec)
and the location or phase of the center of the bump.

We can look at the time course of these observables

#+begin_src ipython
  fig, ax = plt.subplots(1, 3, figsize=[2*width, height])
  
  sns.lineplot(data=data, x='time', y='m0', legend=False, lw=2, ax=ax[0])
  ax[0].set_xlabel('Time (s)')
  ax[0].set_ylabel('$\mathcal{F}_0 (Hz)$')
  ax[1].set_xticks([0, 1, 2, 3, 4])

  sns.lineplot(x=data['time'], y=data['m1']/data['m0'], legend=False, lw=2, ax=ax[1])
  ax[1].set_xlabel('Time (s)')
  ax[1].set_ylabel('$\mathcal{F}_1 / \mathcal{F}_0$')
  ax[1].set_xticks([0, 1, 2, 3, 4])

  sns.lineplot(x=data['time'], y=data['phase']*180/np.pi, legend=False, lw=2, ax=ax[2])
  ax[2].set_xlabel('Time (s)')
  ax[2].set_ylabel('$\phi$ (°)')
  ax[2].set_xticks([0, 1, 2, 3, 4])
  ax[2].set_yticks([0, 90, 180, 270, 360])
  plt.show()
#+end_src

#+RESULTS:
[[file:./.ob-jupyter/8facf447e8da2d0ade4d5113927ed12771ebbe9c.png]]

***** Spatial profile
We can alternatively look at the shape of the bump at different epochs, using circcvl from ../src/analysis/decode.py
Here, during stimulation and during the delay period:

#+begin_src ipython

    # Stimulus presentation
    df_stim = df[df.time < 1.5]
    df_stim = df_stim[df_stim.time >= 1]

    mean_stim = df_stim.groupby("neurons").mean()
    array = mean_stim[["rates"]].to_numpy()

    X_stim = circcvl(array[:, 0], windowSize=10)
    m0, m1, phase = decode_bump(X_stim)

    X_stim = np.roll(X_stim, int((phase / 2.0 / np.pi - 0.5) * X_stim.shape[0]))
#+end_src

#+RESULTS:

#+begin_src ipython  
    df_delay = df[df.time >= 1.5]

    mean_delay = df_delay.groupby("neurons").mean()
    array = mean_delay[["rates"]].to_numpy()

    X_delay = circcvl(array[:, 0], windowSize=10)
    m0, m1, phase = decode_bump(X_delay)

    X_delay = np.roll(X_delay, int((phase / 2.0 / np.pi - 0.5) * X_delay.shape[0]))
#+end_src

#+RESULTS:

#+begin_src ipython

    theta = np.linspace(-180, 180, X_stim.shape[0])
    fig, ax = plt.subplots(1, 2, figsize=[2*width, height])

    ax[0].plot(theta, X_stim)
    ax[0].set_xlabel("Prefered Location (°)")
    ax[0].set_ylabel("Rate (Hz)")
    ax[0].set_xticks([-180, -90, 0, 90, 180])
    ax[0].set_title('Stimulation')
    ax[0].set_ylim([0, 15])

    ax[1].plot(theta, X_delay)
    ax[1].set_xlabel("Prefered Location (°)")
    ax[1].set_ylabel("Rate (Hz)")  
    ax[1].set_xticks([-180, -90, 0, 90, 180])
    ax[1].set_title('Delay')
    ax[1].set_ylim([0, 15])
    plt.show()
#+end_src

#+RESULTS:
[[file:./.ob-jupyter/6fe240c102de5db213e68492f6e2c222ba3f26c7.png]]

** Multiple trials
*** Simulations
**** Control
#+begin_src ipython
  ini_list = np.arange(50, 100)

  REPO_ROOT = "/home/leon/tmp/rnn_numba"

  IF_LOAD_MAT = 0
  IF_SAVE_MAT = 1

  for ini in ini_list:
      print('##########################################')
      print("trial", ini)
      print('##########################################')

      model = Network('config_bump.yml', 'bump_ini_%d' % ini, REPO_ROOT,
                      IF_LOAD_MAT=IF_LOAD_MAT, IF_SAVE_MAT=IF_SAVE_MAT)
      
      model.run()

      IF_LOAD_MAT = 1
      IF_SAVE_MAT = 0
#+end_src

#+results:
#+begin_example
  ##########################################
  trial 50
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_50.h5
  Generating matrix Cij
  Saving matrix to /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.082220532000065s
  ##########################################
  trial 51
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_51.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.034011116003967s
  ##########################################
  trial 52
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_52.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.065252383006737s
  ##########################################
  trial 53
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_53.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.117639357995358s
  ##########################################
  trial 54
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_54.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.030547921996913s
  ##########################################
  trial 55
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_55.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.132905188002042s
  ##########################################
  trial 56
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_56.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.078210111998487s
  ##########################################
  trial 57
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_57.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.117501493004966s
  ##########################################
  trial 58
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_58.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.088514889997896s
  ##########################################
  trial 59
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_59.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.111453446006635s
  ##########################################
  trial 60
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_60.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.16790053099976s
  ##########################################
  trial 61
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_61.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.22554105099698s
  ##########################################
  trial 62
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_62.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.14409792299557s
  ##########################################
  trial 63
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_63.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.151538692996837s
  ##########################################
  trial 64
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_64.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.194099047002965s
  ##########################################
  trial 65
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_65.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.149131943995599s
  ##########################################
  trial 66
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_66.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.130473939003423s
  ##########################################
  trial 67
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_67.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.203092630996252s
  ##########################################
  trial 68
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_68.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.117632073001005s
  ##########################################
  trial 69
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_69.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.134095642992179s
  ##########################################
  trial 70
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_70.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.164453142002458s
  ##########################################
  trial 71
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_71.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.177122163004242s
  ##########################################
  trial 72
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_72.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.112014088997967s
  ##########################################
  trial 73
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_73.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.11745803701342s
  ##########################################
  trial 74
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_74.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.123883219988784s
  ##########################################
  trial 75
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_75.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.189636895011063s
  ##########################################
  trial 76
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_76.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.134159155000816s
  ##########################################
  trial 77
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_77.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.170181580993813s
  ##########################################
  trial 78
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_78.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.181588152991026s
  ##########################################
  trial 79
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_79.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.195748088997789s
  ##########################################
  trial 80
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_80.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.147670706006465s
  ##########################################
  trial 81
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_81.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.147630403997027s
  ##########################################
  trial 82
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_82.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.15983321100066s
  ##########################################
  trial 83
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_83.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.117637618997833s
  ##########################################
  trial 84
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_84.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.17896096300683s
  ##########################################
  trial 85
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_85.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.150496836999082s
  ##########################################
  trial 86
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_86.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.081491399003426s
  ##########################################
  trial 87
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_87.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.176290985997184s
  ##########################################
  trial 88
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_88.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.211406012997031s
  ##########################################
  trial 89
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_89.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.12991519299976s
  ##########################################
  trial 90
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_90.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.122148006994394s
  ##########################################
  trial 91
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_91.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.164027293008985s
  ##########################################
  trial 92
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_92.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.13094631000422s
  ##########################################
  trial 93
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_93.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.10177548599313s
  ##########################################
  trial 94
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_94.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.16783132198907s
  ##########################################
  trial 95
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_95.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.169909983000252s
  ##########################################
  trial 96
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_96.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.090671219004435s
  ##########################################
  trial 97
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_97.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.157331606009393s
  ##########################################
  trial 98
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_98.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.142230319994269s
  ##########################################
  trial 99
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_ini_99.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.192949353004224s
#+end_example

**** NB on
#+begin_src ipython
  IF_LOAD_MAT = 0
  IF_SAVE_MAT = 1

  for ini in ini_list:
      print('##########################################')
      print("trial", ini)
      print('##########################################')

      model = Network('config_bump.yml', 'bump_on_ini_%d' % ini, REPO_ROOT,
                      IF_LOAD_MAT=IF_LOAD_MAT, IF_SAVE_MAT=IF_SAVE_MAT, Iext=[24])
      
      model.run()

      IF_LOAD_MAT = 1
      IF_SAVE_MAT = 0
#+end_src

#+results:
#+begin_example
  ##########################################
  trial 50
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_50.h5
  Generating matrix Cij
  Saving matrix to /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.178143194003496s
  ##########################################
  trial 51
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_51.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.107121998997172s
  ##########################################
  trial 52
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_52.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.13019241800066s
  ##########################################
  trial 53
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_53.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.086722683001426s
  ##########################################
  trial 54
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_54.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.126818060991354s
  ##########################################
  trial 55
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_55.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.14888472900202s
  ##########################################
  trial 56
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_56.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.083044238999719s
  ##########################################
  trial 57
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_57.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.135575193999102s
  ##########################################
  trial 58
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_58.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.154709442009334s
  ##########################################
  trial 59
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_59.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.149330711006769s
  ##########################################
  trial 60
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_60.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.068820390006294s
  ##########################################
  trial 61
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_61.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.188583443989046s
  ##########################################
  trial 62
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_62.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.11044097499689s
  ##########################################
  trial 63
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_63.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.128970951991505s
  ##########################################
  trial 64
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_64.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.085678168994491s
  ##########################################
  trial 65
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_65.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.168274322990328s
  ##########################################
  trial 66
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_66.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.139794802991673s
  ##########################################
  trial 67
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_67.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.16952270299953s
  ##########################################
  trial 68
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_68.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.1735123010003s
  ##########################################
  trial 69
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_69.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.183886453000014s
  ##########################################
  trial 70
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_70.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.230309247999685s
  ##########################################
  trial 71
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_71.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.217128318996402s
  ##########################################
  trial 72
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_72.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.155950993997976s
  ##########################################
  trial 73
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_73.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.114014024002245s
  ##########################################
  trial 74
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_74.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.144614957011072s
  ##########################################
  trial 75
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_75.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.164727608993417s
  ##########################################
  trial 76
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_76.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.167959358004737s
  ##########################################
  trial 77
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_77.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.153387839003699s
  ##########################################
  trial 78
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_78.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.182865342998412s
  ##########################################
  trial 79
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_79.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.170674430992221s
  ##########################################
  trial 80
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_80.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.176295847006259s
  ##########################################
  trial 81
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_81.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.176065250998363s
  ##########################################
  trial 82
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_82.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.172056805997272s
  ##########################################
  trial 83
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_83.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.098337743998854s
  ##########################################
  trial 84
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_84.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.173663291992852s
  ##########################################
  trial 85
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_85.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.241843443000107s
  ##########################################
  trial 86
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_86.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.138605476997327s
  ##########################################
  trial 87
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_87.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.14350137099973s
  ##########################################
  trial 88
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_88.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.191249103998416s
  ##########################################
  trial 89
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_89.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.149700691996259s
  ##########################################
  trial 90
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_90.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.19022013900394s
  ##########################################
  trial 91
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_91.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.191592199000297s
  ##########################################
  trial 92
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_92.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.144294908008305s
  ##########################################
  trial 93
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_93.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.179139497995493s
  ##########################################
  trial 94
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_94.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.146760900999652s
  ##########################################
  trial 95
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_95.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.13161479900009s
  ##########################################
  trial 96
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_96.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.133088406000752s
  ##########################################
  trial 97
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_97.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.165120389996446s
  ##########################################
  trial 98
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_98.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.164041219002684s
  ##########################################
  trial 99
  ##########################################
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_on_ini_99.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.140688684987254s
#+end_example

*** Analysis
**** Imports
#+begin_src ipython
import pandas as pd
from src.analysis.decode import decode_bump
#+end_src

#+RESULTS:

**** Load Control Data
#+begin_src ipython
  ini_list = np.arange(0, 100)
  print(ini_list)
#+end_src

#+RESULTS:
: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
:  24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
:  48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71
:  72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95
:  96 97 98 99]


#+begin_src ipython
  ini_list = np.arange(0, 100)

  df_list = []

  for ini in ini_list:
      df_i = pd.read_hdf(REPO_ROOT + "/data/simul/bump_ini_%d.h5" % ini, mode="r")
      df_i['trial'] = ini
      df_list.append(df_i)

  df = pd.concat(df_list, ignore_index=True)
  print(df.head())
#+end_src

#+RESULTS:
:       rates         ff       h_E  neurons   time  trial
: 0  4.054735  11.287413 -5.966954        0  0.499      0
: 1  0.843916  -3.879444 -5.966949        1  0.499      0
: 2  3.294786  -6.900330 -5.966943        2  0.499      0
: 3  2.031051   3.548604 -5.966936        3  0.499      0
: 4  1.807140 -10.561703 -5.966929        4  0.499      0

#+begin_src ipython
  df_code = df.groupby(['time', 'trial'])['rates'].apply(decode_bump).reset_index()
  df_code[['m0', 'm1', 'phase']] = pd.DataFrame(df_code['rates'].tolist(), index=df_code.index)
  df_code = df_code.drop(columns=['rates'])
  print(df_code.head())
#+end_src

#+RESULTS:
:     time  trial        m0        m1     phase
: 0  0.499      0  2.165932  0.028727  2.656404
: 1  0.499      1  2.199552  0.022388  2.474556
: 2  0.499      2  2.189694  0.044216  4.597539
: 3  0.499      3  2.190472  0.046814  3.863557
: 4  0.499      4  2.160079  0.076171  3.682096

#+begin_src ipython
  end_point = df_code[df_code.time==df_code.time.iloc[-1]]
  end_point = end_point.drop(columns=['time', 'trial'])
  print(end_point.head())
#+end_src

#+RESULTS:
:            m0        m1     phase
: 700  5.888342  5.483750  3.183689
: 701  5.883485  5.558875  3.243685
: 702  5.902112  5.445334  3.218775
: 703  5.880814  5.378419  3.279644
: 704  5.863693  5.475054  3.174738

**** Load NB on Data
Load data
#+begin_src ipython
  ini_list = np.arange(0, 100)

  df_list = []

  for ini in ini_list:
      df_i = pd.read_hdf(REPO_ROOT + "/data/simul/bump_on_ini_%d.h5" % ini, mode="r")
      df_i['trial'] = ini
      df_list.append(df_i)

  df_on = pd.concat(df_list, ignore_index=True)
  print(df_on.head())
#+end_src

#+RESULTS:
:       rates         ff       h_E  neurons   time  trial
: 0  1.734724  -2.912719 -5.928187        0  0.499      0
: 1  0.940182 -14.402127 -5.928192        1  0.499      0
: 2  2.191827  -3.666447 -5.928197        2  0.499      0
: 3  2.949870   5.662764 -5.928201        3  0.499      0
: 4  1.319173   2.274521 -5.928204        4  0.499      0

Decode bump location and amplitude
#+begin_src ipython
  df_on_code = df_on.groupby(['time', 'trial'])['rates'].apply(decode_bump).reset_index()
  df_on_code[['m0', 'm1', 'phase']] = pd.DataFrame(df_on_code['rates'].tolist(), index=df_on_code.index)
  df_on_code = df_on_code.drop(columns=['rates'])
  print(df_on_code.head())
#+end_src

#+RESULTS:
:     time  trial        m0        m1     phase
: 0  0.499      0  2.151777  0.032113  3.184184
: 1  0.499      1  2.190184  0.119403  3.582039
: 2  0.499      2  2.171226  0.079690  5.773302
: 3  0.499      3  2.192930  0.076377  5.369034
: 4  0.499      4  2.169648  0.049598  2.636007

Endpoints
#+begin_src ipython
  end_point_on = df_on_code[df_on_code.time==df_on_code.time.iloc[-1]]
  end_point_on = end_point_on.drop(columns=['time', 'trial'])
  print(end_point_on.head())
#+end_src

#+RESULTS:
:            m0        m1     phase
: 700  8.396407  6.451817  3.172478
: 701  8.396668  6.509976  3.114773
: 702  8.370093  6.502341  3.096552
: 703  8.369641  6.434390  3.225472
: 704  8.379320  6.408697  3.162356

**** Phases 
#+begin_src ipython
  fig, ax = plt.subplots(1, 2, figsize=[2*width, height])

  sns.lineplot(data=df_code, x='time', y=df_code['phase']*180/np.pi, legend=False, lw=2, ax=ax[0], hue='trial', alpha=0.25)

  sns.lineplot(data=df_on_code, x='time', y=df_on_code['phase']*180/np.pi, legend=False, lw=2, ax=ax[0], hue='trial', alpha=0.25)

  ax[0].set_xlabel('Time (s)')
  ax[0].set_ylabel('$\phi$ (°)')
  ax[0].set_xticks([0, 1, 2, 3, 4])
  ax[0].set_yticks([0, 90, 180, 270, 360])

  sns.histplot(data=end_point, x=end_point['phase']*180/np.pi, legend=False, ax=ax[1], bins='auto', kde=True)

  sns.histplot(data=end_point_on, x=end_point_on['phase']*180/np.pi, legend=False, ax=ax[1], bins='auto', kde=True)
  
  ax[1].set_xlabel('$\phi$ (°)')
  ax[1].set_ylabel('$Count$')
  ax[1].set_xticks([160, 180, 200])
  plt.show()
#+end_src

#+RESULTS:
[[file:./.ob-jupyter/784eb653dfc1c8354036d2faed39226641fc9359.png]]

**** Endpoint Errors

#+begin_src ipython
  def get_precision(x):
      return x - circmean(x)
#+end_src

#+RESULTS:

#+begin_src ipython
  from scipy.stats import circmean

  end_point['accuracy'] = (end_point.phase - np.pi) % (2 * np.pi)
  end_point['precision'] = get_precision(end_point.phase)

  end_point_on['accuracy'] = (end_point_on.phase - np.pi) % (2 * np.pi)
  end_point_on['precision'] = get_precision(end_point_on.phase)
  
  print(end_point.head())

#+end_src

#+RESULTS:
:            m0        m1     phase  accuracy  precision
: 700  5.888342  5.483750  3.183689  0.042096   0.030483
: 701  5.883485  5.558875  3.243685  0.102092   0.090479
: 702  5.902112  5.445334  3.218775  0.077183   0.065570
: 703  5.880814  5.378419  3.279644  0.138051   0.126438
: 704  5.863693  5.475054  3.174738  0.033146   0.021533

#+begin_src ipython
  fig, ax = plt.subplots(1, 3, figsize=[2*width, height])

  sns.histplot(data=end_point, x=end_point['phase']*180/np.pi, legend=False, lw=2, ax=ax[0], kde=False, bins=250)
  sns.histplot(data=end_point_on, x=end_point_on['phase']*180/np.pi, legend=False, lw=2, ax=ax[0], kde=False, bins=250)
  ax[0].set_xlabel('$\phi$(°)')
  ax[0].set_ylabel('Count')
  ax[0].set_xticks([0, 90, 180, 270, 360])

  sns.histplot(data=end_point, x=end_point['accuracy']*180/np.pi, legend=False, lw=2, ax=ax[1], kde=False, bins=25)
  sns.histplot(data=end_point_on, x=end_point_on['accuracy']*180/np.pi, legend=False, lw=2, ax=ax[1], kde=False, bins=25)
  ax[1].set_xlabel('$\phi - \phi_{stim}$ (°)')
  ax[1].set_ylabel('Count')
  ax[1].set_xticks([0, 90, 180, 270, 360])

  sns.histplot(data=end_point, x=end_point['precision']*180/np.pi, legend=False, ax=ax[2], bins='auto', kde=True)
  sns.histplot(data=end_point_on, x=end_point_on['precision']*180/np.pi, legend=False, ax=ax[2], bins='auto', kde=True)
  ax[2].set_xlabel('$\phi - <\phi>_{trials}$ (°)')
  ax[2].set_ylabel('$Count$')
  ax[2].set_xlim([-25, 25])

  plt.show()  
#+end_src

#+RESULTS:
[[file:./.ob-jupyter/86130af6a3657ba9e1ba72340f5ca86bf1f5e6d4.png]]

** Parameter Space
*** Changing J0
**** Simulation
#+begin_src ipython
  REPO_ROOT = "/home/leon/tmp/rnn_numba"  
  J0_list = np.linspace(2, 8, 11)
  print(J0_list)
#+end_src

#+RESULTS:
: [2.  2.6 3.2 3.8 4.4 5.  5.6 6.2 6.8 7.4 8. ]

#+begin_src ipython
  IF_LOAD_MAT = 0
  IF_SAVE_MAT = 1

  for J0 in J0_list:
      model = Network('config_bump.yml', 'bump_J0_%.1f' % J0, REPO_ROOT,
                      IF_LOAD_MAT=IF_LOAD_MAT, IF_SAVE_MAT=IF_SAVE_MAT,
                      Jab=[-J0], VERBOSE=0)

      model.run()

      IF_LOAD_MAT = 1
      IF_SAVE_MAT = 0
#+end_src

#+RESULTS:
#+begin_example
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J0_2.0.h5
  Generating matrix Cij
  Saving matrix to /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.064432396990014s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J0_2.6.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 7.989140830002725s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J0_3.2.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.091558501007967s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J0_3.8.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.023728701999062s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J0_4.4.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.02529226099432s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J0_5.0.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.01566048800305s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J0_5.6.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.060480900996481s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J0_6.2.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.044261681003263s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J0_6.8.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.042437109004823s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J0_7.4.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 8.005299901997205s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J0_8.0.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 7.929633299994748s
#+end_example

**** Analysis
#+begin_src ipython
  J0_list = np.linspace(2, 8, 11)

  df_list = []

  for i in range(J0_list.shape[0]):
      df_i = pd.read_hdf(REPO_ROOT + "/data/simul/bump_J0_%.1f.h5" % J0_list[i], mode="r")
      df_i['J0'] = J0_list[i]
      df_list.append(df_i)

  df = pd.concat(df_list, ignore_index=True)
  print(df.head())
#+end_src

#+RESULTS:
:       rates        ff       h_E  neurons   time   J0
: 0  3.145416 -1.738417 -5.219187        0  0.499  2.0
: 1  1.528044  0.385102 -5.219559        1  0.499  2.0
: 2  3.695630 -0.677790 -5.219934        2  0.499  2.0
: 3  3.669666 -8.739937 -5.220311        3  0.499  2.0
: 4  2.544275  3.847788 -5.220691        4  0.499  2.0


#+begin_src ipython
  res = df.groupby(['time', 'J0'])['rates'].apply(decode_bump).reset_index()
  res[['m0', 'm1', 'phase']] = pd.DataFrame(res['rates'].tolist(), index=res.index)
  res = res.drop(columns=['rates'])
  print(res.head())
#+end_src

#+RESULTS:
:     time   J0        m0        m1     phase
: 0  0.499  2.0  2.632982  0.119828  0.751706
: 1  0.499  2.6  2.260633  0.025218  4.007318
: 2  0.499  3.2  1.978117  0.012399  2.526361
: 3  0.499  3.8  1.763846  0.015377  3.128198
: 4  0.499  4.4  1.587709  0.112705  4.632342

#+begin_src ipython
  last = res[res.time==res.time.iloc[-1]]
  last = last.drop(columns=['time'])
  print(last.head())
#+end_src

#+RESULTS:
:      J0        m0        m1     phase
: 77  2.0  7.233351  0.237386  2.502595
: 78  2.6  6.082311  4.668254  2.946384
: 79  3.2  5.413093  6.414884  3.184743
: 80  3.8  4.949595  6.656227  3.094337
: 81  4.4  4.620303  6.681024  3.165527

#+begin_src ipython
  sns.lineplot(last, x='J0', y=last['m1']/last['m0'])
  plt.xlabel('Recurrent Strength $J_0$')
  plt.ylabel('$\mathcal{F}_1$ (Hz)')
  plt.show()
#+end_src

#+RESULTS:
[[file:./.ob-jupyter/5c2e34592b2c99c852c0c734e606c87d5a887195.png]]

#+begin_src ipython

#+end_src

#+RESULTS:

*** Changing J1
**** Simulation
#+begin_src ipython
  REPO_ROOT = "/home/leon/tmp/rnn_numba"  
  J1_list = np.linspace(0, 1, 11)
  print(J1_list)
#+end_src

#+RESULTS:
: [0.  0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1. ]

#+begin_src ipython
  IF_LOAD_MAT = 0
  IF_SAVE_MAT = 0

  for J1 in J1_list:
      model = Network('config_bump.yml', 'bump_J1_%.1f' % J1, REPO_ROOT,
                      IF_LOAD_MAT=IF_LOAD_MAT, IF_SAVE_MAT=IF_SAVE_MAT,
                      KAPPA=[J1], VERBOSE=0)

      model.run()

      IF_LOAD_MAT = 0
      IF_SAVE_MAT = 0
#+end_src

#+RESULTS:
#+begin_example
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J1_0.0.h5
  Generating matrix Cij
  Running simulation
  Elapsed (with compilation) = 8.061212248998345s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J1_0.1.h5
  Generating matrix Cij
  Running simulation
  Elapsed (with compilation) = 8.036842985995463s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J1_0.2.h5
  Generating matrix Cij
  Running simulation
  Elapsed (with compilation) = 8.058933773005265s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J1_0.3.h5
  Generating matrix Cij
  Running simulation
  Elapsed (with compilation) = 8.032721847994253s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J1_0.4.h5
  Generating matrix Cij
  Running simulation
  Elapsed (with compilation) = 7.984838688003947s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J1_0.5.h5
  Generating matrix Cij
  Running simulation
  Elapsed (with compilation) = 8.026162741996814s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J1_0.6.h5
  Generating matrix Cij
  Running simulation
  Elapsed (with compilation) = 7.978958764986601s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J1_0.7.h5
  Generating matrix Cij
  Running simulation
  Elapsed (with compilation) = 7.9543579970049905s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J1_0.8.h5
  Generating matrix Cij
  Running simulation
  Elapsed (with compilation) = 7.932406817999436s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J1_0.9.h5
  Generating matrix Cij
  Running simulation
  Elapsed (with compilation) = 7.918651639003656s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_J1_1.0.h5
  Generating matrix Cij
  Running simulation
  Elapsed (with compilation) = 7.991910406999523s
#+end_example

**** Analysis
#+begin_src ipython
  J1_list = np.linspace(0, 1, 11)

  df_list = []

  for i in range(J1_list.shape[0]):
      df_i = pd.read_hdf(REPO_ROOT + "/data/simul/bump_J1_%.1f.h5" % J1_list[i], mode="r")
      df_i['J1'] = J1_list[i]
      df_list.append(df_i)

  df = pd.concat(df_list, ignore_index=True)
  print(df.head())
#+end_src

#+RESULTS:
:       rates         ff       h_E  neurons   time   J1
: 0  1.780328   3.751463 -5.961933        0  0.499  0.0
: 1  3.168570   5.259105 -5.961933        1  0.499  0.0
: 2  3.115081  12.141036 -5.961933        2  0.499  0.0
: 3  2.222949   1.661346 -5.961933        3  0.499  0.0
: 4  1.914718  -3.024735 -5.961933        4  0.499  0.0

: 3  2.504058  -1.709201 -5.977084        3  0.499  0.0

#+begin_src ipython
  res = df.groupby(['time', 'J1'])['rates'].apply(decode_bump).reset_index()
  res[['m0', 'm1', 'phase']] = pd.DataFrame(res['rates'].tolist(), index=res.index)
  res = res.drop(columns=['rates'])
  print(res.head())
#+end_src

#+RESULTS:
:     time   J1        m0        m1     phase
: 0  0.499  0.0  2.173088  0.062113  3.585447
: 1  0.499  0.1  2.182127  0.063740  2.383803
: 2  0.499  0.2  2.177634  0.034169  2.161832
: 3  0.499  0.3  2.172801  0.048449  1.108637
: 4  0.499  0.4  2.177327  0.059658  1.469172

#+begin_src ipython
  last = res[res.time==res.time.iloc[-1]]
  last = last.drop(columns=['time'])
  print(last.head())
#+end_src

#+RESULTS:
:      J1        m0        m1     phase
: 77  0.0  5.792208  0.021648  0.269616
: 78  0.1  5.756695  0.094577  4.440140
: 79  0.2  5.739243  0.105470  0.896514
: 80  0.3  5.740098  0.056995  5.128754
: 81  0.4  5.880452  5.435077  3.284011

#+begin_src ipython
  sns.lineplot(last, x='J1', y=last['m1']/last['m0'])
  plt.xlabel('Tuning Strength $J_1$')
  plt.ylabel('$\mathcal{F}_1$ (Hz)')
  plt.show()
#+end_src

#+RESULTS:
[[file:./.ob-jupyter/d71a59fba741ab1bf282a12ffca3fe454e2f5fae.png]]

#+begin_src ipython

#+end_src

#+RESULTS:

*** Changing I0
**** Simulation
#+begin_src ipython
  REPO_ROOT = "/home/leon/tmp/rnn_numba"  
  I0_list = np.linspace(10, 30, 11)
  print(I0_list)
#+end_src

#+RESULTS:
: [10. 12. 14. 16. 18. 20. 22. 24. 26. 28. 30.]

#+begin_src ipython
  IF_LOAD_MAT = 0
  IF_SAVE_MAT = 1

  for I0 in I0_list:
      model = Network('config_bump.yml', 'bump_I0_%.1f' % I0, REPO_ROOT,
                      IF_LOAD_MAT=IF_LOAD_MAT, IF_SAVE_MAT=IF_SAVE_MAT,
                      Iext=[I0], VERBOSE=0)

      model.run()

      IF_LOAD_MAT = 1
      IF_SAVE_MAT = 0

#+end_src

#+RESULTS:
#+begin_example
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_I0_10.0.h5
  Generating matrix Cij
  Saving matrix to /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 7.1810109979705885s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_I0_12.0.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 7.145081017049961s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_I0_14.0.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 7.189407243044116s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_I0_16.0.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 7.206623823032714s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_I0_18.0.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 7.2632918279850855s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_I0_20.0.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 7.173060012981296s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_I0_22.0.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 7.135047971038148s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_I0_24.0.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 7.1645337590016425s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_I0_26.0.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 7.200579374912195s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_I0_28.0.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 7.172602592967451s
  Loading config from /home/leon/tmp/rnn_numba/conf/config_bump.yml
  Saving data to /home/leon/tmp/rnn_numba/data/simul/bump_I0_30.0.h5
  Loading matrix from /home/leon/tmp/rnn_numba/data/matrix/Cij.npy
  Running simulation
  Elapsed (with compilation) = 7.21300628897734s
#+end_example

**** Analysis
#+begin_src ipython
  I0_list = np.linspace(10, 30, 11)

  df_list = []

  for i in range(I0_list.shape[0]):
      df_i = pd.read_hdf(REPO_ROOT + "/data/simul/bump_I0_%.1f.h5" % I0_list[i], mode="r")
      df_i['I0'] = I0_list[i]
      df_list.append(df_i)
      
  df = pd.concat(df_list, ignore_index=True)
  print(df.head())
#+end_src

#+RESULTS:
:       rates        ff       h_E  neurons   time    I0
: 0  2.991737  2.570595 -6.026989        0  0.499  10.0
: 1  1.881618  0.980764 -6.026621        1  0.499  10.0
: 2  2.940181 -5.795781 -6.026254        2  0.499  10.0
: 3  1.170019 -0.076887 -6.025889        3  0.499  10.0
: 4  2.863903  2.739512 -6.025525        4  0.499  10.0

#+begin_src ipython
  res = df.groupby(['time', 'I0'])['rates'].apply(decode_bump).reset_index()
  res[['m0', 'm1', 'phase']] = pd.DataFrame(res['rates'].tolist(), index=res.index)
  res = res.drop(columns=['rates'])
  print(res.head())
#+end_src

#+RESULTS:
:     time    I0        m0        m1     phase
: 0  0.499  10.0  2.201509  0.059715  4.983395
: 1  0.499  12.0  2.158195  0.189081  1.364071
: 2  0.499  14.0  2.171295  0.075219  3.018876
: 3  0.499  16.0  2.177301  0.077118  1.571473
: 4  0.499  18.0  2.169490  0.118072  4.750044

#+begin_src ipython
  last = res[res.time==res.time.iloc[-1]]
  last = last.drop(columns=['time'])
  print(last.head())
#+end_src

#+RESULTS:
:       I0        m0        m1     phase
: 77  10.0  4.748553  3.372240  2.832190
: 78  12.0  5.299185  4.570933  2.924747
: 79  14.0  5.893788  5.414350  2.964203
: 80  16.0  6.393171  5.944921  3.220780
: 81  18.0  6.918446  6.382643  3.213330

#+begin_src ipython
  sns.lineplot(last, x='I0', y=last['m1']/last['m0'])
  plt.ylabel('$\mathcal{F}_1$')
  plt.xlabel('FF Input (Hz)')
  plt.show()
#+end_src

#+RESULTS:
[[file:./.ob-jupyter/f41fed7f7c05c69f9b96639fa5508d179967240b.png]]
